<!doctype html>
<html lang="de">
  <head>
    {% load static %}
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Sportfest 2023: Auswertung der Ergebnisse</title>
    
    <link rel="icon" href="{% static 'icon.ico' %}">
    <link rel="stylesheet" href="{% static 'bootstrap.css' %}">
  </head>
  <script>
    function bottomOfPageReached() {
	return (window.innerHeight + Math.round(window.pageYOffset)) >= document.body.offsetHeight;
    }

    function scrollUp() {
	window.scrollTo(0, 0);
    }

    function scrollDown() {
	window.scrollBy(0, 6);
    }

    var reloadScheduled = false;

    function autoScroll() {
	if (bottomOfPageReached()) {
	    setTimeout(() => {
		scrollUp();
		if (reloadScheduled) {
		    reloadScheduled = false;
		    console.info("Unschedule automatic reloading of page.");
		    // Timeout is necessary, otherwise browser will
		    // think we haven't scrolled up yet and stay at
		    // the bottom of the page forever.
		    var t = setTimeout(() => {
			location.reload();
		    }, 500);
		}
		autoScroll();
	    }, 2000);
	} else {
	    scrollDown();
	    setTimeout(() => {
		autoScroll();
	    }, 50);
	}
    }

    function automaticReload() {
	setTimeout(() => {
	    console.info("Automatic reloading of page scheduled.");
	    reloadScheduled = true;
	    automaticReload();
	}, 10000);
    }
    
    function clock() {
	var d = new Date();
	document.querySelector("#clock").innerHTML = d.toLocaleTimeString("de-DE");
	t = setTimeout(() => {
	    clock();
	}, 500);
    }
  </script>
  {% if autoscroll and autoreload %}
  <body class="min-vh-100 d-flex flex-column pt-5" onload="clock();autoScroll();automaticReload();">
  {% elif autoscroll %}
  <body class="min-vh-100 d-flex flex-column pt-5" onload="clock();autoScroll();">
  {% else %}
  <body class="min-vh-100 d-flex flex-column pt-5" onload="clock();">
  {% endif %}
    <header class="mb-5">
      <nav class="navbar fixed-top border-bottom-2 shadow bg-light">
	<div class="container-fluid">
	  <a class="navbar-brand mx-auto ms-sm-0" href="#">
	    <img src="{% static 'icon.png' %}" alt="Logo" width="24" height="24" class="d-inline-block align-text-top shadow-sm">
	    Sportfest 2023 &ndash; Auswertung</a>
	  <div class="w-100 d-block d-sm-none"></div>
	  <div class="navbar mx-auto me-sm-0">
	    <ul class="navbar-nav">
	      <li class="nav-item">
		<span class="navbar-text font-monospace">
		  Uhrzeit: <span id="clock">
		  {% now "G:i:s" %}</span></span>
	      </li>
	    </ul>
	  </div>
	</div>
      </nav>
    </header>
    <main class="container-fluid py-4 mb-2">
      <div class="d-block d-sm-none" style="min-height: 2.5rem;"></div>
      <h1 class="display-5 mb-5">Ergebnisse nach
      Klassenstufen <i class="text-muted h4 fw-normal">(Zuletzt
      aktualisiert um {% now "G:i" %}&nbsp;Uhr)</i></h1>

      {% for level, parallel_classes in scores.items %}
      <article class="mb-5">
        <h2 class="h3 fw-normal mb-3">{{level}}. Jahrgangsstufe</h2>
        <table class="table table-striped table-responsive">
          <thead>
            <tr>
              <th scope="col">Platz</th>
              <th scope="col">Klasse</th>
              <th scope="col">Punktzahl</th>
            </tr>
          </thead>
          <tbody>
	    {% for class in parallel_classes %}
            <tr>
              <th scope="row">{{ class.ranking }}</th>
              <td>{{ class.name }}</td>
              <td>{{ class.score }}</td>
            </tr>
	  {% endfor %}
          </tbody>
        </table>
      </article>
      {% empty %}
      <p style="max-width: 75ch;">Es wurden keine Wertungen
      gefunden. Wenn Sie Administrator sind, so melden Sie sich bitte
      auf der <a href="/admin">Adminseite</a> and und f√ºgen Sie die
      erste Wertung hinzu.
      </p>
      {% endfor %}
    </main>
    <footer class="text-bg-primary mt-auto">
      <div class="row row-cols-1 row-cols-md-2 container-fluid py-3 pe-md-0">
	<div class="col">
	  <p class="mb-3 text-center text-md-start mb-md-0">&copy; 2023 Team IT-Auswertung</p>
	</div>
	<div class="col pe-md-0">
	  <p class="mb-0 text-center text-md-end">Erstellt mit der
	  quelloffenen Software <a class="link-light link-offset-1"
	  href="https://github.com/guemax/Endspurt">Endspurt</a>.</p>
	</div>
    </footer>
  </body>
</html>

